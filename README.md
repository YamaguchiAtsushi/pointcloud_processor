# 概要
本プログラムは、3D LiDAR を搭載した油圧ショベルが掘削動作を行う際に発生する死角を対象とし、  
別の角度から観測することで死角をなくすことが可能な **最適なセンサ設置位置を算出するプログラム** です。  

---

# 使用環境
- OPERA
- ROS2 Humble
- 3D LiDAR 搭載油圧ショベル（ZX120）

※ 実機動作だけでなく、取得済みの rosbag を再生しての実行も可能です。

---

# 実行方法
OPERA 環境内で、3D LiDAR を搭載した油圧ショベル ZX120 を ROS2 上で動作させます。  
以下の launch ファイルを起動することで、本プログラムを使用できます。
```bash
ros2 launch pointcloud_processor start.launch.xml
```

---

# プログラム構成

## 1. **tf_four_wheel_robot.launch.xml**
移動ロボットの TF（座標変換）を定義します。

## 2. **tf_zx120.launch.xml**
油圧ショベル ZX120 の TF（座標変換）を定義します。

## 3. **calc_heading.cpp**
移動ロボットと油圧ショベル ZX120 それぞれに前後2つずつ搭載された GNSS を前提とし、各 GNSS の位置差分から機体の向いている方向を算出します。

## 4. **pointcloud_filter.cpp**
LiDAR の前方にある点群のうち、指定した範囲の点群を抽出します。また、点群の密度をダウンサンプリングします。

## 5. **pointcloud_merger.cpp**
移動ロボットと油圧ショベル ZX120 の座標および方位角を用いて、それぞれの機体から取得された点群を共通座標系（map フレーム）に変換し統合します。

## 6. **excavated_surface_generator.cpp**
油圧ショベル ZX120 の前方の指定位置に、目標掘削地形（L字型または矩形の掘削形状）を生成します。底面と斜面を含む3D点群として出力します。

## 7. **virtual_lidar.cpp**
目標掘削地形に対してレイトレーシングと提案手法を適用し、死角を最小化できる **最適なセンサ設置位置** を算出します。

---
